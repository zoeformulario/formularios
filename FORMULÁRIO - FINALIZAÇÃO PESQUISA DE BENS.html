<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Registro de Pesquisa de Bens</title>

<style>
:root{
  --bg:#e6e6e6;
  --card:#ffffff;
  --text:#111111;
  --label:#000000;
  --line:rgba(0,0,0,.18);
  --btn:#1f6feb;
  --btn2:#d1d5db;
  --btnDanger:#ef4444;
  --radius:16px;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif;
  background:var(--bg);
  color:var(--text);
  padding:28px 14px 60px;
}

.wrap{max-width:1200px;margin:0 auto}

header{
  display:flex;
  justify-content:space-between;
  gap:16px;
  margin-bottom:18px;
  align-items:flex-start;
}

h1{margin:0;font-size:22px;color:#000}
.subtitle{color:#111;font-size:13px;margin-top:6px}

.card{
  background:var(--card);
  border:1px solid var(--line);
  border-radius:var(--radius);
  margin-bottom:18px;
}

.card-hd{
  padding:14px 16px;
  border-bottom:1px solid var(--line);
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:12px;
  background:#f7f7f7;
}

.card-hd h2{
  margin:0;
  font-size:13px;
  text-transform:uppercase;
  color:#000;
  letter-spacing:.3px;
}

.card-bd{padding:16px}

label{
  font-size:14px;
  color:var(--label);
  font-weight:700;
  display:block;
  margin-bottom:6px;
}

input,select,textarea{
  width:100%;
  padding:10px 12px;
  border-radius:12px;
  border:1px solid var(--line);
  background:#fff;
  color:#111;
  font-size:14px;
}

textarea{min-height:90px;resize:vertical}

.row{display:grid;gap:12px;margin-bottom:12px}
@media(min-width:900px){
  .cols-2{grid-template-columns:1fr 1fr}
  .cols-3{grid-template-columns:1.2fr 1fr 1fr}
  .cols-4{grid-template-columns:1.2fr 1fr 1fr .8fr}
  .cols-5{grid-template-columns:1.2fr 1fr 1fr 1fr .8fr}
}

.btns{display:flex;gap:10px;flex-wrap:wrap;align-items:center}

button{
  padding:10px 14px;
  border-radius:12px;
  border:1px solid var(--line);
  background:var(--btn2);
  color:#111;
  cursor:pointer;
  font-weight:700;
}

.primary{background:var(--btn); color:#fff; border-color:rgba(31,111,235,.55)}
.ghost{background:#f3f4f6}
.danger{background:var(--btnDanger); color:#fff; border-color:rgba(239,68,68,.55)}
button:disabled{opacity:.55; cursor:not-allowed}

table{
  width:100%;
  border-collapse:collapse;
  margin-top:12px;
  border:1px solid var(--line);
  background:#fff;
}

th,td{
  padding:10px;
  border-bottom:1px solid var(--line);
  font-size:13px;
  vertical-align:top;
  color:#111;
}

th{
  text-transform:uppercase;
  font-size:12px;
  color:#111;
  background:#f1f5f9;
}

.total{
  display:flex;
  justify-content:space-between;
  margin-top:12px;
  color:#111;
  font-size:13px;
}

.mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}

@media print{
  body{background:#fff;color:#000}
  button,.btns{display:none !important}
  .card{border:1px solid #ccc}
  input,select,textarea{border:1px solid #ccc}
}
</style>
</head>

<body>
<div class="wrap">

<header>
  <div>
    <h1>Registro de Pesquisa de Bens</h1>
    <div class="subtitle">Controle interno de diligências patrimoniais</div>
  </div>
  <div class="subtitle" id="today"></div>
</header>

<div class="card">
  <div class="card-hd"><h2>Identificação</h2></div>
  <div class="card-bd">
    <div class="row cols-2">
      <div>
        <label>GCPJ</label>
        <input id="gcpj" placeholder="Ex.: 2300679346">
      </div>
      <div>
        <label>Processo</label>
        <input id="processo" placeholder="Ex.: 0000000-00.0000.0.00.0000">
      </div>
    </div>
  </div>
</div>

<div class="card">
  <div class="card-hd">
    <h2>Adicionar pesquisa</h2>
    <div class="btns">
      <button class="primary" type="button" onclick="addPesquisa()">Adicionar</button>
      <button class="danger" type="button" id="btnExcluirUltimo" onclick="excluirUltimo()" disabled>Excluir último</button>
      <button class="ghost" type="button" onclick="limparCampos()">Limpar campos</button>
    </div>
  </div>

  <div class="card-bd">
    <div class="row cols-3">
      <div>
        <label>Nome da parte</label>
        <input id="nomeParte" placeholder="Ex.: Fulano de Tal">
      </div>
      <div>
        <label>CPF / CNPJ</label>
        <input id="docParte" placeholder="Ex.: 000.000.000-00 ou 00.000.000/0001-00">
      </div>
      <div>
        <label>Situação do CPF/CNPJ</label>
        <select id="situacaoParte">
          <option>Regular</option>
          <option>Irregular</option>
          <option>Inapto</option>
          <option>Suspenso</option>
          <option>Baixado</option>
          <option>Não consultado</option>
        </select>
      </div>
    </div>

    <div class="row cols-5">
      <div>
        <label>Tipo de pesquisa</label>
        <select id="tipo">
          <option>Certidão</option>
          <option>Pesquisa prévia</option>
          <option>Consulta cadastral</option>
          <option>Investigação Patrimonial Bradesco</option>
        </select>
      </div>
      <div>
        <label>Site utilizado</label>
        <select id="site">
          <option>RI Digital - Registradores</option>
          <option>E-Cartório</option>
          <option>Registro Cível</option>
          <option>Outros</option>
        </select>
      </div>
      <div>
        <label>Data da consulta</label>
        <input id="dataConsulta" type="date">
      </div>
      <div>
        <label>Protocolo</label>
        <input id="protocolo" placeholder="Ex.: 2501061022630">
      </div>
      <div>
        <label>Valor (R$)</label>
        <input id="valor" placeholder="Ex.: 128,21">
      </div>
    </div>

    <div class="row cols-2">
      <div>
        <label>Resultado</label>
        <select id="resultado">
          <option>Nada localizado</option>
          <option>Bem localizado</option>
          <option>Indício de bem</option>
          <option>Pendente</option>
        </select>
      </div>
      <div>
        <label>Conclusão</label>
        <textarea id="conclusao" placeholder="Descreva o que foi consultado e o resultado."></textarea>
      </div>
    </div>

    <table>
      <thead>
        <tr>
          <th>#</th>
          <th>Parte</th>
          <th>CPF/CNPJ</th>
          <th>Situação</th>
          <th>Tipo</th>
          <th>Site</th>
          <th>Data</th>
          <th>Protocolo</th>
          <th>Valor</th>
          <th>Resultado</th>
          <th>Conclusão</th>
        </tr>
      </thead>
      <tbody id="lista"></tbody>
    </table>

    <div class="total">
      <div>Total de pesquisas: <strong id="qtd">0</strong></div>
      <div>Total gasto: <strong id="total">R$ 0,00</strong></div>
    </div>
  </div>
</div>

<div class="card">
  <div class="card-hd">
    <h2>Finalização</h2>
    <div class="btns">
      <button class="ghost" type="button" onclick="window.print()">Imprimir</button>
      <button class="ghost" type="button" onclick="downloadHtml()">Baixar HTML</button>
      <button class="danger" type="button" onclick="limparTudo()">Limpar tudo</button>
    </div>
  </div>
  <div class="card-bd">
    <label>Observações finais</label>
    <textarea id="obsFinais" placeholder="Observações gerais do caso, próximos passos, etc."></textarea>
  </div>
</div>

</div>

<script>
const pesquisas = [];
const lista = document.getElementById("lista");
const qtd = document.getElementById("qtd");
const total = document.getElementById("total");
const btnExcluirUltimo = document.getElementById("btnExcluirUltimo");

function parseBRLToNumber(input){
  if(!input) return 0;
  const cleaned = String(input).trim()
    .replace(/\./g,"")
    .replace(",",".")
    .replace(/[^\d.]/g,"");
  const n = Number(cleaned);
  return Number.isFinite(n) ? n : 0;
}

function formatNumberToBRL(n){
  const v = Number.isFinite(n) ? n : 0;
  return v.toLocaleString("pt-BR", { style:"currency", currency:"BRL" });
}

function escapeHtml(s){
  return String(s ?? "")
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#39;");
}

function formatDateBR(iso){
  if(!iso) return "";
  const [y,m,d] = iso.split("-");
  if(!y || !m || !d) return iso;
  return d + "/" + m + "/" + y;
}

function setDefaultDateIfEmpty(){
  const el = document.getElementById("dataConsulta");
  if(!el.value){
    const d = new Date();
    const yyyy = d.getFullYear();
    const mm = String(d.getMonth() + 1).padStart(2,"0");
    const dd = String(d.getDate()).padStart(2,"0");
    el.value = yyyy + "-" + mm + "-" + dd;
  }
}

function addPesquisa(){
  const parte = document.getElementById("nomeParte").value.trim();
  const doc = document.getElementById("docParte").value.trim();
  const situacao = document.getElementById("situacaoParte").value;
  const tipo = document.getElementById("tipo").value;
  const site = document.getElementById("site").value;

  setDefaultDateIfEmpty();
  const dataConsulta = document.getElementById("dataConsulta").value;

  const protocolo = document.getElementById("protocolo").value.trim();
  const valor = parseBRLToNumber(document.getElementById("valor").value);
  const resultado = document.getElementById("resultado").value;
  const conclusao = document.getElementById("conclusao").value.trim();

  if(!parte){
    alert("Preencha o nome da parte.");
    document.getElementById("nomeParte").focus();
    return;
  }
  if(!doc){
    alert("Preencha o CPF/CNPJ.");
    document.getElementById("docParte").focus();
    return;
  }
  if(!dataConsulta){
    alert("Informe a data da consulta.");
    document.getElementById("dataConsulta").focus();
    return;
  }

  pesquisas.push({parte, doc, situacao, tipo, site, dataConsulta, protocolo, valor, resultado, conclusao});
  render();
  limparCampos(true);
}

function excluirUltimo(){
  if(pesquisas.length === 0) return;
  pesquisas.pop();
  render();
}

function limparCampos(keepParte = false){
  if(!keepParte){
    document.getElementById("nomeParte").value = "";
    document.getElementById("docParte").value = "";
    document.getElementById("situacaoParte").value = "Regular";
  }
  document.getElementById("dataConsulta").value = "";
  document.getElementById("protocolo").value = "";
  document.getElementById("valor").value = "";
  document.getElementById("resultado").value = "Nada localizado";
  document.getElementById("conclusao").value = "";
}

function limparTudo(){
  if(!confirm("Tem certeza que deseja limpar tudo?")) return;

  document.getElementById("gcpj").value = "";
  document.getElementById("processo").value = "";
  document.getElementById("nomeParte").value = "";
  document.getElementById("docParte").value = "";
  document.getElementById("situacaoParte").value = "Regular";
  document.getElementById("tipo").value = "Certidão";
  document.getElementById("site").value = "RI Digital - Registradores";
  document.getElementById("dataConsulta").value = "";
  document.getElementById("protocolo").value = "";
  document.getElementById("valor").value = "";
  document.getElementById("resultado").value = "Nada localizado";
  document.getElementById("conclusao").value = "";
  document.getElementById("obsFinais").value = "";

  pesquisas.length = 0;
  render();
}

function render(){
  lista.innerHTML = "";
  let soma = 0;

  pesquisas.forEach((p, i) => {
    soma += p.valor || 0;

    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${i + 1}</td>
      <td>${escapeHtml(p.parte)}</td>
      <td class="mono">${escapeHtml(p.doc)}</td>
      <td>${escapeHtml(p.situacao)}</td>
      <td>${escapeHtml(p.tipo)}</td>
      <td>${escapeHtml(p.site)}</td>
      <td class="mono">${escapeHtml(formatDateBR(p.dataConsulta))}</td>
      <td class="mono">${escapeHtml(p.protocolo || "")}</td>
      <td class="mono">${escapeHtml(formatNumberToBRL(p.valor || 0))}</td>
      <td>${escapeHtml(p.resultado)}</td>
      <td>${escapeHtml(p.conclusao || "")}</td>
    `;
    lista.appendChild(tr);
  });

  qtd.textContent = String(pesquisas.length);
  total.textContent = formatNumberToBRL(soma);
  btnExcluirUltimo.disabled = pesquisas.length === 0;
}

function downloadHtml(){
  const html = "<!doctype html>\n" + document.documentElement.outerHTML;
  const blob = new Blob([html], { type: "text/html;charset=utf-8" });
  const url = URL.createObjectURL(blob);

  const gcpj = (document.getElementById("gcpj").value || "").trim().replace(/[^\dA-Za-z_-]+/g,"_");
  const proc = (document.getElementById("processo").value || "").trim().replace(/[^\dA-Za-z_-]+/g,"_");
  const stamp = new Date().toISOString().slice(0,10);

  const nameBase = ["pesquisa_bens", gcpj || null, proc || null, stamp].filter(Boolean).join("_");
  const a = document.createElement("a");
  a.href = url;
  a.download = nameBase + ".html";
  document.body.appendChild(a);
  a.click();
  a.remove();

  setTimeout(() => URL.revokeObjectURL(url), 500);
}

(function(){
  const d = new Date();
  const dd = String(d.getDate()).padStart(2,"0");
  const mm = String(d.getMonth()+1).padStart(2,"0");
  const yy = d.getFullYear();
  document.getElementById("today").textContent = dd + "/" + mm + "/" + yy;

  setDefaultDateIfEmpty();
})();
</script>

</body>
</html>
